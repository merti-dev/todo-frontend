<section class="wrap">
  <header class="hero">
    <div class="brand">
      <span class="cube">🧊</span>
      <h1>Countdown Todo</h1>
    </div>

    <div class="add">
      <input
        [(ngModel)]="newTitle"
        (keyup.enter)="addTodo()"
        placeholder="What's up!?"
        aria-label="Title" />
      <button class="btn" (click)="toggleDetails()">
        {{ detailsOpen ? 'Hide detail' : 'Add detail' }}
      </button>
      <button class="btn primary" (click)="addTodo()">Add</button>
    </div>

    <textarea
      *ngIf="detailsOpen"
      [(ngModel)]="newContent"
      rows="3"
      placeholder="Detail (optional)">
    </textarea>
  </header>

  <div class="list">
    @for (todo of todos; track todo.id) {
      <article class="card" [class.open]="openId === todo.id">
        <div class="row">
          <a class="title" [routerLink]="['/blog', todo.id]">{{ todo.title }}</a>

          <div class="meta">
            <time>{{ todo.createdAt }} 00:00</time>
            <button class="icon" title="Edit" (click)="startEdit(todo)">✏️</button>
            <button class="icon" title="Delete" (click)="deleteTodo(todo.id)">🗑️</button>
            <button class="icon expander" (click)="toggleOpen(todo.id)"
                    [attr.aria-expanded]="openId===todo.id">▾</button>
          </div>
        </div>

        <div class="content" *ngIf="openId===todo.id">
          <div [innerHTML]="todo.content || '<em>No content</em>'"></div>
          <div class="inline-edit" *ngIf="editId===todo.id">
            <input [(ngModel)]="editTitle" placeholder="Title" />
            <textarea [(ngModel)]="editContent" rows="4" placeholder="Content (HTML)"></textarea>
            <div class="actions">
              <button class="btn" (click)="cancelEdit()">Cancel</button>
              <button class="btn primary" (click)="saveEdit(todo.id)">Save</button>
            </div>
          </div>
        </div>
      </article>
    }
  </div>
</section>
